<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JPYC Survey - „Ç¢„É≥„Ç±„Éº„Éà„Å´Á≠î„Åà„Å¶JPYC„ÇíÁç≤Âæó | Web3ÂØæÂøúÁâà</title>
    
    <!-- Web3 and Ethers.js -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    
    <!-- React and Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Toastify for notifications -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        
        .jpyc-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .network-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { ethers } = window;

        // JPYC Contract Configuration
        const JPYC_CONFIG = {
            // JPYC on Polygon Mainnet
            polygon: {
                chainId: '0x89', // 137
                chainName: 'Polygon Mainnet',
                contractAddress: '0x6AE7Dfc73E0dDE2aa99ac063DcF7e8A63265108c',
                rpcUrl: 'https://polygon-rpc.com/',
                blockExplorer: 'https://polygonscan.com',
                nativeCurrency: {
                    name: 'MATIC',
                    symbol: 'MATIC',
                    decimals: 18
                }
            },
            // JPYC on Ethereum Mainnet
            ethereum: {
                chainId: '0x1', // 1
                chainName: 'Ethereum Mainnet',
                contractAddress: '0x2370f9d504c7a6E775bf6E14B3F12846b594cD53',
                rpcUrl: 'https://eth.llamarpc.com',
                blockExplorer: 'https://etherscan.io',
                nativeCurrency: {
                    name: 'Ethereum',
                    symbol: 'ETH',
                    decimals: 18
                }
            },
            // For testing on Mumbai (Polygon Testnet)
            mumbai: {
                chainId: '0x13881', // 80001
                chainName: 'Mumbai Testnet',
                contractAddress: '0x0000000000000000000000000000000000000000', // „ÉÜ„Çπ„ÉàÁî®
                rpcUrl: 'https://rpc-mumbai.maticvigil.com/',
                blockExplorer: 'https://mumbai.polygonscan.com',
                nativeCurrency: {
                    name: 'MATIC',
                    symbol: 'MATIC',
                    decimals: 18
                }
            }
        };

        // JPYC ERC20 ABI (ÊúÄÂ∞èÈôê)
        const JPYC_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function decimals() view returns (uint8)",
            "function symbol() view returns (string)",
            "event Transfer(address indexed from, address indexed to, uint256 value)"
        ];

        // Survey Payout Contract ABI (Â∞ÜÊù•ÂÆüË£ÖÁî®)
        const SURVEY_CONTRACT_ABI = [
            "function claimReward(uint256 surveyId, bytes32 answerHash) returns (bool)",
            "function getSurveyReward(uint256 surveyId) view returns (uint256)",
            "function hasClaimedReward(address user, uint256 surveyId) view returns (bool)",
            "event RewardClaimed(address indexed user, uint256 indexed surveyId, uint256 amount)"
        ];

        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [provider, setProvider] = useState(null);
            const [signer, setSigner] = useState(null);
            const [walletAddress, setWalletAddress] = useState('');
            const [isConnected, setIsConnected] = useState(false);
            const [jpycBalance, setJpycBalance] = useState('0');
            const [currentNetwork, setCurrentNetwork] = useState('');
            const [selectedSurvey, setSelectedSurvey] = useState(null);
            const [surveyAnswers, setSurveyAnswers] = useState({});
            const [completedSurveys, setCompletedSurveys] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [pendingRewards, setPendingRewards] = useState([]);

            // Survey Data
            const surveys = [
                {
                    id: 1,
                    title: "Web3„É¶„Éº„Ç∂„ÉºË™øÊüª 2025",
                    reward: 100,
                    estimatedTime: "5ÂàÜ",
                    category: "Web3",
                    sponsor: "JPYCÊ†™Âºè‰ºöÁ§æ",
                    totalBudget: 10000,
                    remainingBudget: 8500,
                    responses: 15,
                    maxResponses: 100,
                    questions: [
                        {
                            id: 'q1',
                            question: "„Å©„ÅÆ„Éñ„É≠„ÉÉ„ÇØ„ÉÅ„Çß„Éº„É≥„ÇíÊúÄ„ÇÇ„Çà„Åè‰ΩøÁî®„Åó„Åæ„Åô„ÅãÔºü",
                            type: 'single',
                            options: ["Ethereum", "Polygon", "Arbitrum", "Solana", "„Åù„ÅÆ‰ªñ"]
                        },
                        {
                            id: 'q2',
                            question: "JPYC„ÅÆ‰∏ª„Å™Áî®ÈÄî„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                            type: 'multiple',
                            options: ["ÈÄÅÈáë„ÉªÊ±∫Ê∏à", "DeFiÈÅãÁî®", "NFTË≥ºÂÖ•", "‰æ°ÂÄ§„ÅÆ‰øùÂ≠ò", "„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞"]
                        },
                        {
                            id: 'q3',
                            question: "Êúà„Å´„Å©„ÅÆ„Åè„Çâ„ÅÑJPYC„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÅãÔºü",
                            type: 'single',
                            options: ["10,000ÂÜÜÊú™Ê∫Ä", "10,000-50,000ÂÜÜ", "50,000-100,000ÂÜÜ", "100,000ÂÜÜ‰ª•‰∏ä"]
                        }
                    ]
                },
                {
                    id: 2,
                    title: "DeFi„Éó„É≠„Éà„Ç≥„É´Âà©Áî®ÂÆüÊÖãË™øÊüª",
                    reward: 150,
                    estimatedTime: "7ÂàÜ",
                    category: "DeFi",
                    sponsor: "DeFi Research Lab",
                    totalBudget: 15000,
                    remainingBudget: 12000,
                    responses: 20,
                    maxResponses: 100,
                    questions: [
                        {
                            id: 'q1',
                            question: "Âà©Áî®„Åó„Åü„Åì„Å®„Åå„ÅÇ„ÇãDeFi„Éó„É≠„Éà„Ç≥„É´„ÅØÔºüÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ",
                            type: 'multiple',
                            options: ["Uniswap", "Aave", "Compound", "Curve", "QuickSwap", "„Åù„ÅÆ‰ªñ"]
                        },
                        {
                            id: 'q2',
                            question: "DeFi„Åß„ÅÆ‰∏ª„Å™ÈÅãÁî®ÊñπÊ≥ï„ÅØÔºü",
                            type: 'single',
                            options: ["ÊµÅÂãïÊÄßÊèê‰æõ", "„É¨„É≥„Éá„Ç£„É≥„Ç∞", "„Çπ„ÉÜ„Éº„Ç≠„É≥„Ç∞", "„Ç§„Éº„É´„Éâ„Éï„Ç°„Éº„Éü„É≥„Ç∞"]
                        },
                        {
                            id: 'q3',
                            question: "DeFiÂà©Áî®ÊôÇ„ÅÆÊúÄÂ§ß„ÅÆÊá∏Âøµ‰∫ãÈ†Ö„ÅØÔºü",
                            type: 'single',
                            options: ["„Çπ„Éû„Éº„Éà„Ç≥„É≥„Éà„É©„ÇØ„Éà„É™„Çπ„ÇØ", "„Ç§„É≥„Éë„Éº„Éû„Éç„É≥„Éà„É≠„Çπ", "„Ç¨„Çπ‰ª£", "Ë¶èÂà∂„É™„Çπ„ÇØ", "‰Ωø„ÅÑÊñπ„ÅÆË§áÈõë„Åï"]
                        }
                    ]
                },
                {
                    id: 3,
                    title: "NFT„Éû„Éº„Ç±„ÉÉ„ÉàÂãïÂêëË™øÊüª",
                    reward: 80,
                    estimatedTime: "4ÂàÜ",
                    category: "NFT",
                    sponsor: "NFT Analytics Inc.",
                    totalBudget: 8000,
                    remainingBudget: 7200,
                    responses: 10,
                    maxResponses: 100,
                    questions: [
                        {
                            id: 'q1',
                            question: "NFT„ÇíË≥ºÂÖ•„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÅãÔºü",
                            type: 'single',
                            options: ["„ÅØ„ÅÑ", "„ÅÑ„ÅÑ„Åà", "Ê§úË®é‰∏≠"]
                        },
                        {
                            id: 'q2',
                            question: "ËààÂë≥„Åå„ÅÇ„ÇãNFT„Ç´„ÉÜ„Ç¥„É™„ÅØÔºü",
                            type: 'multiple',
                            options: ["„Ç¢„Éº„Éà", "„Ç≤„Éº„É†", "Èü≥Ê•Ω", "„É°„Çø„Éê„Éº„Çπ", "„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£NFT"]
                        }
                    ]
                }
            ];

            // Show notification
            const showNotification = (message, type = 'info') => {
                const backgroundColor = type === 'success' ? '#10b981' : 
                                       type === 'error' ? '#ef4444' : 
                                       type === 'warning' ? '#f59e0b' : '#667eea';
                
                Toastify({
                    text: message,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    style: {
                        background: backgroundColor,
                        borderRadius: "8px",
                        fontFamily: "'Noto Sans JP', sans-serif"
                    }
                }).showToast();
            };

            // Connect to MetaMask
            const connectWallet = async () => {
                if (typeof window.ethereum === 'undefined') {
                    showNotification('MetaMask„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    window.open('https://metamask.io/download/', '_blank');
                    return;
                }

                setIsLoading(true);
                try {
                    // Request account access
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    if (accounts.length === 0) {
                        throw new Error('„Ç¢„Ç´„Ç¶„É≥„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    }

                    // Setup provider and signer
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    
                    setProvider(provider);
                    setSigner(signer);
                    setWalletAddress(accounts[0]);
                    setIsConnected(true);

                    // Get network
                    const network = await provider.getNetwork();
                    const chainId = '0x' + network.chainId.toString(16);
                    setCurrentNetwork(chainId);

                    // Get JPYC balance
                    await updateJPYCBalance(provider, accounts[0], chainId);

                    showNotification('„Ç¶„Ç©„É¨„ÉÉ„ÉàÊé•Á∂öÊàêÂäüÔºÅ', 'success');

                    // Setup event listeners
                    window.ethereum.on('accountsChanged', handleAccountsChanged);
                    window.ethereum.on('chainChanged', handleChainChanged);

                } catch (error) {
                    console.error('Wallet connection error:', error);
                    showNotification(`Êé•Á∂ö„Ç®„É©„Éº: ${error.message}`, 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // Update JPYC Balance
            const updateJPYCBalance = async (provider, address, chainId) => {
                try {
                    let contractAddress;
                    
                    // Select appropriate contract based on network
                    if (chainId === '0x89') {
                        contractAddress = JPYC_CONFIG.polygon.contractAddress;
                    } else if (chainId === '0x1') {
                        contractAddress = JPYC_CONFIG.ethereum.contractAddress;
                    } else {
                        setJpycBalance('0');
                        return;
                    }

                    const jpycContract = new ethers.Contract(contractAddress, JPYC_ABI, provider);
                    const balance = await jpycContract.balanceOf(address);
                    const decimals = await jpycContract.decimals();
                    const formattedBalance = ethers.utils.formatUnits(balance, decimals);
                    
                    setJpycBalance(parseFloat(formattedBalance).toFixed(2));
                } catch (error) {
                    console.error('Balance fetch error:', error);
                    setJpycBalance('0');
                }
            };

            // Handle account change
            const handleAccountsChanged = (accounts) => {
                if (accounts.length === 0) {
                    disconnectWallet();
                } else {
                    setWalletAddress(accounts[0]);
                    if (provider) {
                        updateJPYCBalance(provider, accounts[0], currentNetwork);
                    }
                }
            };

            // Handle chain change
            const handleChainChanged = (chainId) => {
                window.location.reload();
            };

            // Disconnect wallet
            const disconnectWallet = () => {
                setIsConnected(false);
                setWalletAddress('');
                setProvider(null);
                setSigner(null);
                setJpycBalance('0');
                setCurrentNetwork('');
                
                if (window.ethereum) {
                    window.ethereum.removeListener('accountsChanged', handleAccountsChanged);
                    window.ethereum.removeListener('chainChanged', handleChainChanged);
                }
            };

            // Switch to Polygon Network
            const switchToPolygon = async () => {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: JPYC_CONFIG.polygon.chainId }],
                    });
                } catch (switchError) {
                    // This error code indicates that the chain has not been added to MetaMask.
                    if (switchError.code === 4902) {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: JPYC_CONFIG.polygon.chainId,
                                    chainName: JPYC_CONFIG.polygon.chainName,
                                    nativeCurrency: JPYC_CONFIG.polygon.nativeCurrency,
                                    rpcUrls: [JPYC_CONFIG.polygon.rpcUrl],
                                    blockExplorerUrls: [JPYC_CONFIG.polygon.blockExplorer]
                                }],
                            });
                        } catch (addError) {
                            console.error('Error adding Polygon network:', addError);
                        }
                    }
                }
            };

            // Start survey
            const startSurvey = (survey) => {
                if (!isConnected) {
                    showNotification('„Åæ„Åö„Ç¶„Ç©„É¨„ÉÉ„Éà„ÇíÊé•Á∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                    return;
                }
                
                // Check if already completed
                if (completedSurveys.includes(survey.id)) {
                    showNotification('„Åì„ÅÆ„Ç¢„É≥„Ç±„Éº„Éà„ÅØÊó¢„Å´ÂõûÁ≠îÊ∏à„Åø„Åß„Åô', 'info');
                    return;
                }

                // Check remaining budget
                if (survey.remainingBudget < survey.reward) {
                    showNotification('„Åì„ÅÆ„Ç¢„É≥„Ç±„Éº„Éà„ÅÆ‰∫àÁÆó„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü', 'warning');
                    return;
                }

                setSelectedSurvey(survey);
                setCurrentView('survey');
                setSurveyAnswers({});
            };

            // Complete survey and claim reward
            const completeSurvey = async () => {
                const allQuestionsAnswered = selectedSurvey.questions.every(
                    q => surveyAnswers[q.id] && surveyAnswers[q.id].length > 0
                );

                if (!allQuestionsAnswered) {
                    showNotification('„Åô„Åπ„Å¶„ÅÆË≥™Âïè„Å´ÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                    return;
                }

                setIsLoading(true);

                try {
                    // In production, this would interact with a smart contract
                    // For now, we'll simulate the process
                    
                    // Create answer hash (in production, this would be stored on-chain or IPFS)
                    const answerData = JSON.stringify(surveyAnswers);
                    const answerHash = ethers.utils.id(answerData);

                    // Simulate transaction
                    showNotification('Â†±ÈÖ¨„ÇíË´ãÊ±Ç‰∏≠...', 'info');
                    
                    // In production: Call smart contract to claim reward
                    // const surveyContract = new ethers.Contract(SURVEY_CONTRACT_ADDRESS, SURVEY_CONTRACT_ABI, signer);
                    // const tx = await surveyContract.claimReward(selectedSurvey.id, answerHash);
                    // await tx.wait();

                    // Simulate delay
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    // Update state
                    setCompletedSurveys(prev => [...prev, selectedSurvey.id]);
                    setPendingRewards(prev => [...prev, {
                        surveyId: selectedSurvey.id,
                        amount: selectedSurvey.reward,
                        timestamp: new Date().toISOString(),
                        txHash: '0x' + Math.random().toString(16).substr(2, 64) // Simulated
                    }]);

                    showNotification(`üéâ ${selectedSurvey.reward} JPYCÁç≤ÂæóÔºÅÔºà‰øùÁïô‰∏≠Ôºâ`, 'success');
                    
                    // Return to dashboard
                    setCurrentView('dashboard');
                    setSelectedSurvey(null);

                    // Update balance (in production, this would be automatic after blockchain confirmation)
                    setTimeout(() => {
                        setJpycBalance(prev => (parseFloat(prev) + selectedSurvey.reward).toFixed(2));
                    }, 3000);

                } catch (error) {
                    console.error('Survey completion error:', error);
                    showNotification('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // Header Component
            const Header = () => (
                <div className="jpyc-gradient text-white shadow-lg">
                    <div className="container mx-auto px-4 py-4">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center space-x-3">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23fff'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle' fill='%23667eea'%3E¬•%3C/text%3E%3C/svg%3E" 
                                     alt="JPYC" className="w-10 h-10" />
                                <div>
                                    <h1 className="text-2xl font-bold">JPYC Survey</h1>
                                    <p className="text-xs opacity-90">Web3„Ç¢„É≥„Ç±„Éº„Éà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center space-x-4">
                                {isConnected ? (
                                    <>
                                        {currentNetwork && (
                                            <div className="network-badge bg-white/20 rounded-lg px-3 py-2 text-sm">
                                                {currentNetwork === '0x89' ? 'üü£ Polygon' : 
                                                 currentNetwork === '0x1' ? 'üî∑ Ethereum' : 
                                                 '‚ö†Ô∏è ÈùûÂØæÂøú'}
                                            </div>
                                        )}
                                        <div className="bg-white/20 rounded-lg px-4 py-2">
                                            <div className="text-xs opacity-90">ÊÆãÈ´ò</div>
                                            <div className="text-xl font-bold">{jpycBalance} JPYC</div>
                                        </div>
                                        <div className="bg-white/20 rounded-lg px-4 py-2">
                                            <div className="text-xs opacity-90">„Ç¶„Ç©„É¨„ÉÉ„Éà</div>
                                            <div className="font-mono text-sm">
                                                {walletAddress.slice(0, 6)}...{walletAddress.slice(-4)}
                                            </div>
                                        </div>
                                        <button 
                                            onClick={disconnectWallet}
                                            className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm transition"
                                        >
                                            ÂàáÊñ≠
                                        </button>
                                    </>
                                ) : (
                                    <button 
                                        onClick={connectWallet}
                                        className="bg-white text-purple-600 px-6 py-3 rounded-lg font-bold hover:bg-gray-100 transition flex items-center space-x-2"
                                        disabled={isLoading}
                                    >
                                        {isLoading ? (
                                            <div className="loading-spinner w-5 h-5"></div>
                                        ) : (
                                            <>
                                                <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" 
                                                     alt="MetaMask" className="w-5 h-5" />
                                                <span>MetaMask„ÅßÊé•Á∂ö</span>
                                            </>
                                        )}
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Dashboard Component
            const Dashboard = () => (
                <div className="container mx-auto px-4 py-8">
                    {/* Network Alert */}
                    {isConnected && currentNetwork !== '0x89' && (
                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 flex justify-between items-center">
                            <div>
                                <p className="text-yellow-800 font-bold">‚ö†Ô∏è Polygon„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å´Âàá„ÇäÊõø„Åà„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                <p className="text-yellow-600 text-sm">JPYC„ÅÆÈÄÅÂèó‰ø°„Å´„ÅØPolygon„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÊé®Â•®„Åó„Åæ„Åô</p>
                            </div>
                            <button 
                                onClick={switchToPolygon}
                                className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition"
                            >
                                Polygon„Å´Âàá„ÇäÊõø„Åà
                            </button>
                        </div>
                    )}

                    {/* Stats Overview */}
                    <div className="grid md:grid-cols-4 gap-4 mb-8">
                        <div className="bg-white rounded-xl card-shadow p-6">
                            <div className="text-3xl mb-2">üí∞</div>
                            <div className="text-2xl font-bold text-purple-600">{jpycBalance}</div>
                            <div className="text-gray-500 text-sm">JPYCÊÆãÈ´ò</div>
                        </div>
                        <div className="bg-white rounded-xl card-shadow p-6">
                            <div className="text-3xl mb-2">üìù</div>
                            <div className="text-2xl font-bold text-purple-600">{completedSurveys.length}</div>
                            <div className="text-gray-500 text-sm">ÂÆå‰∫Ü„Ç¢„É≥„Ç±„Éº„Éà</div>
                        </div>
                        <div className="bg-white rounded-xl card-shadow p-6">
                            <div className="text-3xl mb-2">‚è≥</div>
                            <div className="text-2xl font-bold text-purple-600">{pendingRewards.length}</div>
                            <div className="text-gray-500 text-sm">‰øùÁïô‰∏≠„ÅÆÂ†±ÈÖ¨</div>
                        </div>
                        <div className="bg-white rounded-xl card-shadow p-6">
                            <div className="text-3xl mb-2">üéØ</div>
                            <div className="text-2xl font-bold text-purple-600">
                                {surveys.filter(s => !completedSurveys.includes(s.id)).length}
                            </div>
                            <div className="text-gray-500 text-sm">ÂõûÁ≠îÂèØËÉΩ</div>
                        </div>
                    </div>

                    {/* Survey List */}
                    <h2 className="text-2xl font-bold mb-6">üìä „Ç¢„É≥„Ç±„Éº„Éà‰∏ÄË¶ß</h2>
                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {surveys.map(survey => {
                            const isCompleted = completedSurveys.includes(survey.id);
                            const progress = (survey.responses / survey.maxResponses) * 100;
                            
                            return (
                                <div key={survey.id} className="bg-white rounded-xl card-shadow overflow-hidden hover:transform hover:scale-105 transition-all">
                                    <div className="p-6">
                                        <div className="flex justify-between items-start mb-3">
                                            <span className="bg-purple-100 text-purple-600 text-xs px-2 py-1 rounded-full">
                                                {survey.category}
                                            </span>
                                            <div className="text-right">
                                                <div className="text-2xl font-bold text-purple-600">{survey.reward}</div>
                                                <div className="text-xs text-gray-500">JPYC</div>
                                            </div>
                                        </div>
                                        
                                        <h3 className="text-lg font-bold mb-2">{survey.title}</h3>
                                        <p className="text-xs text-gray-500 mb-3">Êèê‰æõ: {survey.sponsor}</p>
                                        
                                        <div className="space-y-2 mb-4">
                                            <div className="flex items-center text-sm text-gray-600">
                                                <span>‚è± {survey.estimatedTime}</span>
                                                <span className="mx-2">‚Ä¢</span>
                                                <span>üìù {survey.questions.length}Âïè</span>
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between text-xs text-gray-500 mb-1">
                                                    <span>ÂõûÁ≠îÊï∞: {survey.responses}/{survey.maxResponses}</span>
                                                    <span>{progress.toFixed(0)}%</span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                    <div className="jpyc-gradient h-2 rounded-full" style={{width: `${progress}%`}}></div>
                                                </div>
                                            </div>
                                            
                                            <div className="text-xs text-gray-500">
                                                ÊÆã„Çä‰∫àÁÆó: {survey.remainingBudget.toLocaleString()} JPYC
                                            </div>
                                        </div>
                                        
                                        {isCompleted ? (
                                            <button className="w-full bg-gray-200 text-gray-500 py-3 rounded-lg font-bold cursor-not-allowed">
                                                ‚úÖ ÂõûÁ≠îÊ∏à„Åø
                                            </button>
                                        ) : survey.remainingBudget < survey.reward ? (
                                            <button className="w-full bg-gray-200 text-gray-500 py-3 rounded-lg font-bold cursor-not-allowed">
                                                ‰∫àÁÆóÁµÇ‰∫Ü
                                            </button>
                                        ) : (
                                            <button 
                                                onClick={() => startSurvey(survey)}
                                                className="w-full jpyc-gradient text-white py-3 rounded-lg font-bold hover:opacity-90 transition"
                                            >
                                                „Ç¢„É≥„Ç±„Éº„ÉàÈñãÂßã
                                            </button>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Pending Rewards */}
                    {pendingRewards.length > 0 && (
                        <div className="mt-12">
                            <h3 className="text-xl font-bold mb-4">‚è≥ ‰øùÁïô‰∏≠„ÅÆÂ†±ÈÖ¨</h3>
                            <div className="bg-white rounded-xl card-shadow p-6">
                                <div className="space-y-3">
                                    {pendingRewards.map((reward, index) => (
                                        <div key={index} className="flex justify-between items-center border-b pb-3 last:border-0">
                                            <div>
                                                <p className="font-semibold">
                                                    Survey #{reward.surveyId}
                                                </p>
                                                <p className="text-xs text-gray-500">
                                                    {new Date(reward.timestamp).toLocaleString('ja-JP')}
                                                </p>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-bold text-purple-600">+{reward.amount} JPYC</p>
                                                <a 
                                                    href={`https://polygonscan.com/tx/${reward.txHash}`}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="text-xs text-blue-500 hover:underline"
                                                >
                                                    TxÁ¢∫Ë™ç
                                                </a>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );

            // Survey View Component
            const SurveyView = () => {
                const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
                const currentQuestion = selectedSurvey.questions[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / selectedSurvey.questions.length) * 100;

                const handleAnswer = (questionId, answer) => {
                    setSurveyAnswers(prev => ({
                        ...prev,
                        [questionId]: answer
                    }));
                };

                const handleNext = () => {
                    if (!surveyAnswers[currentQuestion.id] || surveyAnswers[currentQuestion.id].length === 0) {
                        showNotification('ÂõûÁ≠î„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                        return;
                    }

                    if (currentQuestionIndex < selectedSurvey.questions.length - 1) {
                        setCurrentQuestionIndex(prev => prev + 1);
                    } else {
                        completeSurvey();
                    }
                };

                const handlePrevious = () => {
                    if (currentQuestionIndex > 0) {
                        setCurrentQuestionIndex(prev => prev - 1);
                    }
                };

                const handleOptionClick = (option) => {
                    if (currentQuestion.type === 'single') {
                        handleAnswer(currentQuestion.id, [option]);
                    } else {
                        const currentAnswers = surveyAnswers[currentQuestion.id] || [];
                        if (currentAnswers.includes(option)) {
                            handleAnswer(currentQuestion.id, currentAnswers.filter(a => a !== option));
                        } else {
                            handleAnswer(currentQuestion.id, [...currentAnswers, option]);
                        }
                    }
                };

                return (
                    <div className="container mx-auto px-4 py-8 max-w-2xl">
                        <div className="bg-white rounded-xl card-shadow p-8">
                            <div className="mb-6">
                                <div className="flex justify-between items-center mb-2">
                                    <h2 className="text-xl font-bold">{selectedSurvey.title}</h2>
                                    <span className="text-purple-600 font-bold">Â†±ÈÖ¨: {selectedSurvey.reward} JPYC</span>
                                </div>
                                <p className="text-sm text-gray-500 mb-3">Êèê‰æõ: {selectedSurvey.sponsor}</p>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div className="jpyc-gradient h-2 rounded-full transition-all" style={{width: `${progress}%`}}></div>
                                </div>
                                <div className="text-sm text-gray-500 mt-2">
                                    Ë≥™Âïè {currentQuestionIndex + 1} / {selectedSurvey.questions.length}
                                </div>
                            </div>

                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4">{currentQuestion.question}</h3>
                                {currentQuestion.type === 'multiple' && (
                                    <p className="text-sm text-gray-500 mb-4">ÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</p>
                                )}
                                
                                <div className="space-y-3">
                                    {currentQuestion.options.map(option => {
                                        const isSelected = (surveyAnswers[currentQuestion.id] || []).includes(option);
                                        return (
                                            <button
                                                key={option}
                                                onClick={() => handleOptionClick(option)}
                                                className={`w-full text-left p-4 rounded-lg border-2 transition-all ${
                                                    isSelected 
                                                        ? 'border-purple-500 bg-purple-50' 
                                                        : 'border-gray-200 hover:border-purple-300'
                                                }`}
                                            >
                                                <div className="flex items-center">
                                                    {currentQuestion.type === 'single' ? (
                                                        <div className={`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${
                                                            isSelected ? 'border-purple-500' : 'border-gray-300'
                                                        }`}>
                                                            {isSelected && (
                                                                <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
                                                            )}
                                                        </div>
                                                    ) : (
                                                        <div className={`w-5 h-5 rounded border-2 mr-3 flex items-center justify-center ${
                                                            isSelected ? 'border-purple-500 bg-purple-500' : 'border-gray-300'
                                                        }`}>
                                                            {isSelected && (
                                                                <span className="text-white text-xs">‚úì</span>
                                                            )}
                                                        </div>
                                                    )}
                                                    {option}
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="flex justify-between">
                                <button 
                                    onClick={() => setCurrentView('dashboard')}
                                    className="px-6 py-3 text-gray-600 hover:text-gray-800 transition"
                                >
                                    ‰∏≠Êñ≠„Åô„Çã
                                </button>
                                <div className="space-x-3">
                                    {currentQuestionIndex > 0 && (
                                        <button 
                                            onClick={handlePrevious}
                                            className="px-6 py-3 border border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 transition"
                                        >
                                            Êàª„Çã
                                        </button>
                                    )}
                                    <button 
                                        onClick={handleNext}
                                        className="jpyc-gradient text-white px-8 py-3 rounded-lg font-bold hover:opacity-90 transition"
                                        disabled={isLoading}
                                    >
                                        {isLoading ? (
                                            <div className="loading-spinner w-5 h-5 mx-auto"></div>
                                        ) : (
                                            currentQuestionIndex === selectedSurvey.questions.length - 1 ? 'ÈÄÅ‰ø°„Åó„Å¶Â†±ÈÖ¨Áç≤Âæó' : 'Ê¨°„Å∏'
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50">
                    <Header />
                    {currentView === 'dashboard' && <Dashboard />}
                    {currentView === 'survey' && selectedSurvey && <SurveyView />}
                    
                    {/* Footer */}
                    <footer className="mt-12 py-8 border-t border-gray-200">
                        <div className="container mx-auto px-4">
                            <div className="text-center text-gray-500 text-sm">
                                <p>JPYC Survey - Web3ÊôÇ‰ª£„ÅÆ„Ç¢„É≥„Ç±„Éº„Éà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</p>
                                <p className="mt-2">
                                    Powered by{' '}
                                    <a href="https://jpyc.jp" target="_blank" rel="noopener noreferrer" className="text-purple-600 hover:underline">
                                        JPYC
                                    </a>
                                    {' '}|{' '}
                                    <a href="https://polygon.technology" target="_blank" rel="noopener noreferrer" className="text-purple-600 hover:underline">
                                        Polygon
                                    </a>
                                </p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>